<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - English with Thành Nam</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Be Vietnam Pro', sans-serif; }
        .sidebar-link { transition: all 0.2s ease-in-out; }
        .sidebar-link:hover { background-color: #4f46e5; color: white; }
        .sidebar-link.active { background-color: #4f46e5; color: white; font-weight: 600; }
        .modal { display: none; }
        .modal.is-open { display: flex; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="flex h-screen bg-gray-200">
        <!-- Sidebar -->
        <div class="fixed z-30 inset-y-0 left-0 w-64 bg-gray-800 text-white transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-200 ease-in-out">
            <div class="px-8 py-4">
                <h2 class="text-2xl font-semibold">Admin Panel</h2>
            </div>
            <nav class="mt-10">
                <a id="nav-dashboard" href="#" class="sidebar-link mt-1 flex items-center py-2 px-8 active">
                    <i class="fas fa-tachometer-alt mr-3"></i> Dashboard
                </a>
                <a id="nav-classes" href="#" class="sidebar-link mt-1 flex items-center py-2 px-8">
                    <i class="fas fa-school mr-3"></i> Quản Lý Lớp Học
                </a>
                <a id="nav-students" href="#" class="sidebar-link mt-1 flex items-center py-2 px-8">
                    <i class="fas fa-user-graduate mr-3"></i> Quản Lý Học Sinh
                </a>
                <a id="nav-content" href="#" class="sidebar-link mt-1 flex items-center py-2 px-8">
                    <i class="fas fa-book mr-3"></i> Quản Lý Nội Dung
                </a>
                <a id="nav-assignments" href="#" class="sidebar-link mt-1 flex items-center py-2 px-8">
                    <i class="fas fa-tasks mr-3"></i> Quản Lý Bài Tập
                </a>
            </nav>
        </div>

        <!-- Main content -->
        <div class="flex-1 flex flex-col overflow-hidden">
            <header class="flex justify-between items-center p-6 bg-white border-b-2 border-gray-200">
                <div>
                    <h1 id="page-title" class="text-2xl font-bold text-gray-800">Dashboard</h1>
                </div>
                <div>
                    <span id="admin-name" class="mr-4"></span>
                    <button id="logout-button" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">Đăng xuất</button>
                </div>
            </header>
            <main id="main-content" class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-6">
                <!-- Nội dung của từng module sẽ được render vào đây -->
            </main>
        </div>
    </div>

    <!-- Modal for adding student -->
    <div id="add-student-modal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full items-center justify-center">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">Tạo Tài Khoản Học Sinh Mới</h3>
            <div class="space-y-4">
                <div>
                    <label for="student-name" class="block text-sm font-medium text-gray-700">Họ và tên</label>
                    <input type="text" id="student-name" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="student-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="student-email" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>
                <div>
                    <label for="student-password" class="block text-sm font-medium text-gray-700">Mật khẩu ban đầu</label>
                    <input type="password" id="student-password" class="mt-1 block w-full p-2 border border-gray-300 rounded-md">
                </div>
            </div>
            <div class="mt-6 flex justify-end space-x-3">
                <button id="cancel-add-student" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300">Hủy</button>
                <button id="confirm-add-student" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Tạo Tài Khoản</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
const firebaseConfig = {
  apiKey: "AIzaSyCRaRV5JEwXlHWSPSrCYxyIIPjDWFMsV9A",
  authDomain: "ielts-foundation-6ea9d.firebaseapp.com",
  projectId: "ielts-foundation-6ea9d",
  storageBucket: "ielts-foundation-6ea9d.appspot.com",
  messagingSenderId: "296690693780",
  appId: "1:296690693780:web:f9a54a9ded68a73dcd2681",
  measurementId: "G-CZD89F0FC3"
};
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.firestore();

        const pageTitle = document.getElementById('page-title');
        const mainContent = document.getElementById('main-content');
        const adminName = document.getElementById('admin-name');
        const logoutButton = document.getElementById('logout-button');
        const addStudentModal = document.getElementById('add-student-modal');

        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists && doc.data().role === 'admin') {
                        adminName.textContent = user.displayName || user.email;
                        renderDashboard();
                    } else {
                        auth.signOut();
                        window.location.href = 'login.html';
                    }
                });
            } else {
                window.location.href = 'login.html';
            }
        });
        
        logoutButton.addEventListener('click', () => {
            auth.signOut().then(() => { window.location.href = 'index.html'; });
        });

        document.querySelectorAll('.sidebar-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                e.currentTarget.classList.add('active');
                
                const navId = e.currentTarget.id;
                if (navId === 'nav-dashboard') renderDashboard();
                if (navId === 'nav-classes') renderClassManagement();
                if (navId === 'nav-students') renderStudentManagement();
                if (navId === 'nav-content') renderContentManagement();
                if (navId === 'nav-assignments') renderAssignmentManagement();
            });
        });

        // --- MODULE: DASHBOARD ---
        async function renderDashboard() {
            pageTitle.textContent = 'Dashboard';
            mainContent.innerHTML = `<p>Đang tải thống kê...</p>`;
            
            const [usersSnap, classesSnap, assignmentsSnap] = await Promise.all([
                db.collection('users').where('role', '==', 'student').get(),
                db.collection('classes').get(),
                db.collection('assignments').get()
            ]);

            mainContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Tổng số học sinh</h3>
                        <p class="text-3xl font-bold text-indigo-600 mt-2">${usersSnap.size}</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Tổng số lớp học</h3>
                        <p class="text-3xl font-bold text-indigo-600 mt-2">${classesSnap.size}</p>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-lg font-semibold text-gray-700">Tổng số bài tập</h3>
                        <p class="text-3xl font-bold text-indigo-600 mt-2">${assignmentsSnap.size}</p>
                    </div>
                </div>
            `;
        }

        // --- MODULE: CLASS MANAGEMENT ---
        async function renderClassManagement() {
            pageTitle.textContent = 'Quản Lý Lớp Học';
            mainContent.innerHTML = `<p>Đang tải danh sách lớp học...</p>`;
            // ... (code của Quản lý lớp học từ trước)
        }

        // --- MODULE: STUDENT MANAGEMENT ---
        async function renderStudentManagement() {
            pageTitle.textContent = 'Quản Lý Học Sinh';
            mainContent.innerHTML = `<p>Đang tải danh sách học sinh...</p>`;
            // ... (code của Quản lý học sinh từ trước)
        }

        // --- MODULE: CONTENT MANAGEMENT ---
        function renderContentManagement() {
            pageTitle.textContent = 'Quản Lý Nội Dung';
            mainContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <a href="admin_vocab_tool.html" target="_blank" class="block bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow">
                        <h3 class="text-xl font-bold text-green-600">Kho Từ Vựng</h3>
                        <p class="mt-2 text-gray-600">Tạo và quản lý các bộ từ vựng cho từng unit học.</p>
                    </a>
                    <a href="#" class="block bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow">
                        <h3 class="text-xl font-bold text-blue-600">Kho Bài Kiểm Tra</h3>
                        <p class="mt-2 text-gray-600">Tạo và quản lý các đề kiểm tra Reading, Listening...</p>
                        <span class="text-sm text-gray-400">(Sắp ra mắt)</span>
                    </a>
                </div>
            `;
        }

        // --- MODULE: ASSIGNMENT MANAGEMENT ---
        function renderAssignmentManagement() {
            pageTitle.textContent = 'Quản Lý Bài Tập';
            mainContent.innerHTML = `
                <div class="grid grid-cols-1 gap-6">
                    <a href="admin_assignment_tool.html" target="_blank" class="block bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow">
                        <h3 class="text-xl font-bold text-purple-600">Giao Bài Tập Mới</h3>
                        <p class="mt-2 text-gray-600">Tạo bài tập về nhà mới và giao cho các lớp học.</p>
                    </a>
                    <!-- Vùng hiển thị danh sách bài tập đã giao sẽ được xây dựng ở đây -->
                </div>
            `;
        }
        
        // --- EVENT LISTENERS FOR MODALS AND DYNAMIC CONTENT ---
        mainContent.addEventListener('click', async (e) => {
            if (e.target.id === 'show-add-student-modal-btn') {
                addStudentModal.classList.add('is-open');
            }
            // ... (các event listener khác)
        });

        document.getElementById('cancel-add-student').addEventListener('click', () => {
            addStudentModal.classList.remove('is-open');
        });

        document.getElementById('confirm-add-student').addEventListener('click', () => {
            alert("Chức năng này cần được thiết lập trên máy chủ (Firebase Functions) để đảm bảo bảo mật. Vui lòng tạo tài khoản trực tiếp trên Firebase Authentication Console và sau đó thêm thông tin vào Firestore.");
        });

    </script>
</body>
</html>
